# 🎮 FFXIV战斗数据API项目

## 📖 项目简介

这是一个将 Final Fantasy XIV ACT Plugin 的战斗数据解析功能封装成现代化 REST API 的完整解决方案。通过这个项目，您可以：

- 📊 **实时获取战斗统计**: DPS、HPS、技能使用等数据
- 🔄 **WebSocket实时推送**: 即时战斗事件流
- 🔍 **技能信息查询**: 基于现有JSON定义的完整技能数据库
- 🌐 **跨平台访问**: 支持Web、移动端、桌面应用集成
- 🎯 **易于集成**: 标准REST API + WebSocket接口

## 📁 文件结构

```
api_design/
├── 📋 项目说明.md           # 本文件 - 项目概览
├── 📖 使用指南.md           # 详细使用教程
├── 📚 README.md           # 英文版说明文档
├── 🏗️ architecture.md      # 系统架构设计
│
├── 🐍 Python后端文件
│   ├── main.py             # FastAPI主服务
│   ├── api_models.py       # 数据模型定义
│   ├── combat_parser.py    # 核心解析引擎
│   ├── data_collector.py   # 数据采集客户端
│   └── requirements.txt    # Python依赖包
│
├── 🌐 前端和工具
│   ├── frontend_example.html # React实时仪表板
│   ├── test_api.py          # API功能测试脚本
│   ├── start.bat           # Windows启动脚本
│   └── start.sh            # Linux/Mac启动脚本
```

## 🎯 核心功能

### 1. 实时战斗数据解析
- ✅ 基于原版JSON定义文件的技能映射
- ✅ 实时DPS/HPS计算
- ✅ 多目标伤害处理
- ✅ 状态效果DOT/HOT计算
- ✅ 暴击/直击统计

### 2. RESTful API接口
```http
GET /api/v1/combat/current          # 当前战斗信息
GET /api/v1/combat/live/stats       # 实时统计数据  
GET /api/v1/combat/live/events      # 最近战斗事件
GET /api/v1/definitions/jobs        # 职业技能定义
GET /api/v1/search/actions          # 技能搜索
```

### 3. WebSocket实时推送
```javascript
const ws = new WebSocket('ws://localhost:8000/ws/live');
ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    // 处理实时战斗事件
};
```

### 4. 数据采集方式
- 🔗 **ACT日志文件监控**: 读取ACT生成的日志
- 🌐 **WebSocket连接**: 连接OverlayPlugin等
- 🧪 **模拟数据生成**: 用于测试和演示

## 🚀 使用场景

### 1. 团队战斗监控
```python
import requests

# 获取实时DPS排行
stats = requests.get('/api/v1/combat/live/stats').json()
for player, data in sorted(stats.items(), key=lambda x: x[1]['dps'], reverse=True):
    print(f"{player}: {data['dps']:.1f} DPS")
```

### 2. Discord机器人集成
```python
import discord
from discord.ext import commands

@bot.command()
async def dps(ctx):
    stats = await get_live_stats()
    embed = discord.Embed(title="当前DPS排行")
    for player, data in stats.items():
        embed.add_field(name=player, value=f"{data['dps']:.1f} DPS")
    await ctx.send(embed=embed)
```

### 3. Web实时仪表板
- 📱 **响应式设计**: 适配PC和移动端
- 📊 **实时图表**: 动态DPS曲线
- 🎨 **现代化UI**: 玻璃拟态设计风格
- ⚡ **实时更新**: WebSocket自动刷新

### 4. OBS直播覆盖
```html
<!-- 在OBS中添加浏览器源 -->
<div id="dps-overlay">
    <!-- 通过API实时显示团队DPS -->
</div>
```

## 🔧 技术特点

### 高性能架构
- ⚡ **异步处理**: FastAPI + asyncio
- 📈 **高并发**: 支持多客户端同时连接
- 🔄 **实时推送**: WebSocket低延迟通信
- 💾 **内存缓存**: 热点数据快速访问

### 模块化设计
- 🧩 **解耦架构**: 解析器、API、前端独立
- 🔌 **插件化**: 易于扩展新功能
- 🛠️ **可配置**: 支持自定义设置
- 🔄 **热更新**: 支持定义文件动态加载

### 跨平台兼容
- 🖥️ **Windows**: 完整支持ACT集成
- 🐧 **Linux**: 服务器部署优化
- 🍎 **macOS**: 开发环境友好
- ☁️ **云端**: 支持容器化部署

## 📊 实际效果展示

### API响应示例
```json
{
  "combatant_id": "player_001",
  "total_damage": 145230,
  "dps": 2420.5,
  "critical_rate": 24.8,
  "direct_hit_rate": 18.2,
  "hit_count": 156
}
```

### WebSocket事件示例
```json
{
  "type": "damage",
  "timestamp": "2024-01-15T10:30:45.123Z",
  "source_name": "黑魔法师",
  "target_name": "石卫塔",
  "action_name": "Fire IV",
  "damage": 2850,
  "is_critical": true
}
```

## 🛠️ 快速部署

### 本地开发
```bash
# 1. 克隆项目
git clone <repository>
cd api_design

# 2. 安装依赖
pip install -r requirements.txt

# 3. 启动服务
python main.py

# 4. 测试功能
python test_api.py
```

### 生产部署
```bash
# 使用Gunicorn部署
pip install gunicorn
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker

# 使用Docker部署
docker build -t ffxiv-api .
docker run -p 8000:8000 ffxiv-api
```

## 🎨 定制化开发

### 添加新的API接口
```python
@app.get("/api/v1/custom/endpoint")
async def custom_endpoint():
    # 您的自定义逻辑
    return {"message": "自定义数据"}
```

### 扩展数据解析
```python
def parse_custom_event(self, raw_data):
    # 解析自定义游戏事件
    return processed_event
```

### 集成外部服务
```python
# 连接数据库
from sqlalchemy.ext.asyncio import create_async_engine

# 连接消息队列
import aio_pika

# 集成监控系统
import prometheus_client
```

## 🎯 下一步计划

- [ ] 添加历史数据存储（PostgreSQL）
- [ ] 实现用户认证和权限控制
- [ ] 支持更多游戏数据源
- [ ] 创建移动端App
- [ ] 添加数据分析和报告功能
- [ ] 支持多语言国际化

## 💡 获取帮助

1. **查看文档**: 阅读 [使用指南.md](./使用指南.md)
2. **运行测试**: 执行 `python test_api.py`
3. **检查日志**: 查看控制台输出信息
4. **在线文档**: 访问 http://localhost:8000/docs

## 🎉 开始使用

现在就开始您的FFXIV战斗数据API之旅吧！

1. **运行启动脚本**: `start.bat` (Windows) 或 `./start.sh` (Linux/Mac)
2. **打开前端示例**: `frontend_example.html`
3. **运行功能测试**: `python test_api.py`
4. **开始集成**: 使用API构建您的应用

祝您使用愉快！ 🎮✨
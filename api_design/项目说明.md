# ğŸ® FFXIVæˆ˜æ–—æ•°æ®APIé¡¹ç›®

## ğŸ“– é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªå°† Final Fantasy XIV ACT Plugin çš„æˆ˜æ–—æ•°æ®è§£æåŠŸèƒ½å°è£…æˆç°ä»£åŒ– REST API çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæ‚¨å¯ä»¥ï¼š

- ğŸ“Š **å®æ—¶è·å–æˆ˜æ–—ç»Ÿè®¡**: DPSã€HPSã€æŠ€èƒ½ä½¿ç”¨ç­‰æ•°æ®
- ğŸ”„ **WebSocketå®æ—¶æ¨é€**: å³æ—¶æˆ˜æ–—äº‹ä»¶æµ
- ğŸ” **æŠ€èƒ½ä¿¡æ¯æŸ¥è¯¢**: åŸºäºç°æœ‰JSONå®šä¹‰çš„å®Œæ•´æŠ€èƒ½æ•°æ®åº“
- ğŸŒ **è·¨å¹³å°è®¿é—®**: æ”¯æŒWebã€ç§»åŠ¨ç«¯ã€æ¡Œé¢åº”ç”¨é›†æˆ
- ğŸ¯ **æ˜“äºé›†æˆ**: æ ‡å‡†REST API + WebSocketæ¥å£

## ğŸ“ æ–‡ä»¶ç»“æ„

```
api_design/
â”œâ”€â”€ ğŸ“‹ é¡¹ç›®è¯´æ˜.md           # æœ¬æ–‡ä»¶ - é¡¹ç›®æ¦‚è§ˆ
â”œâ”€â”€ ğŸ“– ä½¿ç”¨æŒ‡å—.md           # è¯¦ç»†ä½¿ç”¨æ•™ç¨‹
â”œâ”€â”€ ğŸ“š README.md           # è‹±æ–‡ç‰ˆè¯´æ˜æ–‡æ¡£
â”œâ”€â”€ ğŸ—ï¸ architecture.md      # ç³»ç»Ÿæ¶æ„è®¾è®¡
â”‚
â”œâ”€â”€ ğŸ Pythonåç«¯æ–‡ä»¶
â”‚   â”œâ”€â”€ main.py             # FastAPIä¸»æœåŠ¡
â”‚   â”œâ”€â”€ api_models.py       # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ combat_parser.py    # æ ¸å¿ƒè§£æå¼•æ“
â”‚   â”œâ”€â”€ data_collector.py   # æ•°æ®é‡‡é›†å®¢æˆ·ç«¯
â”‚   â””â”€â”€ requirements.txt    # Pythonä¾èµ–åŒ…
â”‚
â”œâ”€â”€ ğŸŒ å‰ç«¯å’Œå·¥å…·
â”‚   â”œâ”€â”€ frontend_example.html # Reactå®æ—¶ä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ test_api.py          # APIåŠŸèƒ½æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ start.bat           # Windowså¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ start.sh            # Linux/Macå¯åŠ¨è„šæœ¬
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. å®æ—¶æˆ˜æ–—æ•°æ®è§£æ
- âœ… åŸºäºåŸç‰ˆJSONå®šä¹‰æ–‡ä»¶çš„æŠ€èƒ½æ˜ å°„
- âœ… å®æ—¶DPS/HPSè®¡ç®—
- âœ… å¤šç›®æ ‡ä¼¤å®³å¤„ç†
- âœ… çŠ¶æ€æ•ˆæœDOT/HOTè®¡ç®—
- âœ… æš´å‡»/ç›´å‡»ç»Ÿè®¡

### 2. RESTful APIæ¥å£
```http
GET /api/v1/combat/current          # å½“å‰æˆ˜æ–—ä¿¡æ¯
GET /api/v1/combat/live/stats       # å®æ—¶ç»Ÿè®¡æ•°æ®  
GET /api/v1/combat/live/events      # æœ€è¿‘æˆ˜æ–—äº‹ä»¶
GET /api/v1/definitions/jobs        # èŒä¸šæŠ€èƒ½å®šä¹‰
GET /api/v1/search/actions          # æŠ€èƒ½æœç´¢
```

### 3. WebSocketå®æ—¶æ¨é€
```javascript
const ws = new WebSocket('ws://localhost:8000/ws/live');
ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    // å¤„ç†å®æ—¶æˆ˜æ–—äº‹ä»¶
};
```

### 4. æ•°æ®é‡‡é›†æ–¹å¼
- ğŸ”— **ACTæ—¥å¿—æ–‡ä»¶ç›‘æ§**: è¯»å–ACTç”Ÿæˆçš„æ—¥å¿—
- ğŸŒ **WebSocketè¿æ¥**: è¿æ¥OverlayPluginç­‰
- ğŸ§ª **æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ**: ç”¨äºæµ‹è¯•å’Œæ¼”ç¤º

## ğŸš€ ä½¿ç”¨åœºæ™¯

### 1. å›¢é˜Ÿæˆ˜æ–—ç›‘æ§
```python
import requests

# è·å–å®æ—¶DPSæ’è¡Œ
stats = requests.get('/api/v1/combat/live/stats').json()
for player, data in sorted(stats.items(), key=lambda x: x[1]['dps'], reverse=True):
    print(f"{player}: {data['dps']:.1f} DPS")
```

### 2. Discordæœºå™¨äººé›†æˆ
```python
import discord
from discord.ext import commands

@bot.command()
async def dps(ctx):
    stats = await get_live_stats()
    embed = discord.Embed(title="å½“å‰DPSæ’è¡Œ")
    for player, data in stats.items():
        embed.add_field(name=player, value=f"{data['dps']:.1f} DPS")
    await ctx.send(embed=embed)
```

### 3. Webå®æ—¶ä»ªè¡¨æ¿
- ğŸ“± **å“åº”å¼è®¾è®¡**: é€‚é…PCå’Œç§»åŠ¨ç«¯
- ğŸ“Š **å®æ—¶å›¾è¡¨**: åŠ¨æ€DPSæ›²çº¿
- ğŸ¨ **ç°ä»£åŒ–UI**: ç»ç’ƒæ‹Ÿæ€è®¾è®¡é£æ ¼
- âš¡ **å®æ—¶æ›´æ–°**: WebSocketè‡ªåŠ¨åˆ·æ–°

### 4. OBSç›´æ’­è¦†ç›–
```html
<!-- åœ¨OBSä¸­æ·»åŠ æµè§ˆå™¨æº -->
<div id="dps-overlay">
    <!-- é€šè¿‡APIå®æ—¶æ˜¾ç¤ºå›¢é˜ŸDPS -->
</div>
```

## ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹

### é«˜æ€§èƒ½æ¶æ„
- âš¡ **å¼‚æ­¥å¤„ç†**: FastAPI + asyncio
- ğŸ“ˆ **é«˜å¹¶å‘**: æ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶è¿æ¥
- ğŸ”„ **å®æ—¶æ¨é€**: WebSocketä½å»¶è¿Ÿé€šä¿¡
- ğŸ’¾ **å†…å­˜ç¼“å­˜**: çƒ­ç‚¹æ•°æ®å¿«é€Ÿè®¿é—®

### æ¨¡å—åŒ–è®¾è®¡
- ğŸ§© **è§£è€¦æ¶æ„**: è§£æå™¨ã€APIã€å‰ç«¯ç‹¬ç«‹
- ğŸ”Œ **æ’ä»¶åŒ–**: æ˜“äºæ‰©å±•æ–°åŠŸèƒ½
- ğŸ› ï¸ **å¯é…ç½®**: æ”¯æŒè‡ªå®šä¹‰è®¾ç½®
- ğŸ”„ **çƒ­æ›´æ–°**: æ”¯æŒå®šä¹‰æ–‡ä»¶åŠ¨æ€åŠ è½½

### è·¨å¹³å°å…¼å®¹
- ğŸ–¥ï¸ **Windows**: å®Œæ•´æ”¯æŒACTé›†æˆ
- ğŸ§ **Linux**: æœåŠ¡å™¨éƒ¨ç½²ä¼˜åŒ–
- ğŸ **macOS**: å¼€å‘ç¯å¢ƒå‹å¥½
- â˜ï¸ **äº‘ç«¯**: æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²

## ğŸ“Š å®é™…æ•ˆæœå±•ç¤º

### APIå“åº”ç¤ºä¾‹
```json
{
  "combatant_id": "player_001",
  "total_damage": 145230,
  "dps": 2420.5,
  "critical_rate": 24.8,
  "direct_hit_rate": 18.2,
  "hit_count": 156
}
```

### WebSocketäº‹ä»¶ç¤ºä¾‹
```json
{
  "type": "damage",
  "timestamp": "2024-01-15T10:30:45.123Z",
  "source_name": "é»‘é­”æ³•å¸ˆ",
  "target_name": "çŸ³å«å¡”",
  "action_name": "Fire IV",
  "damage": 2850,
  "is_critical": true
}
```

## ğŸ› ï¸ å¿«é€Ÿéƒ¨ç½²

### æœ¬åœ°å¼€å‘
```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository>
cd api_design

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¯åŠ¨æœåŠ¡
python main.py

# 4. æµ‹è¯•åŠŸèƒ½
python test_api.py
```

### ç”Ÿäº§éƒ¨ç½²
```bash
# ä½¿ç”¨Gunicornéƒ¨ç½²
pip install gunicorn
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker

# ä½¿ç”¨Dockeréƒ¨ç½²
docker build -t ffxiv-api .
docker run -p 8000:8000 ffxiv-api
```

## ğŸ¨ å®šåˆ¶åŒ–å¼€å‘

### æ·»åŠ æ–°çš„APIæ¥å£
```python
@app.get("/api/v1/custom/endpoint")
async def custom_endpoint():
    # æ‚¨çš„è‡ªå®šä¹‰é€»è¾‘
    return {"message": "è‡ªå®šä¹‰æ•°æ®"}
```

### æ‰©å±•æ•°æ®è§£æ
```python
def parse_custom_event(self, raw_data):
    # è§£æè‡ªå®šä¹‰æ¸¸æˆäº‹ä»¶
    return processed_event
```

### é›†æˆå¤–éƒ¨æœåŠ¡
```python
# è¿æ¥æ•°æ®åº“
from sqlalchemy.ext.asyncio import create_async_engine

# è¿æ¥æ¶ˆæ¯é˜Ÿåˆ—
import aio_pika

# é›†æˆç›‘æ§ç³»ç»Ÿ
import prometheus_client
```

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] æ·»åŠ å†å²æ•°æ®å­˜å‚¨ï¼ˆPostgreSQLï¼‰
- [ ] å®ç°ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- [ ] æ”¯æŒæ›´å¤šæ¸¸æˆæ•°æ®æº
- [ ] åˆ›å»ºç§»åŠ¨ç«¯App
- [ ] æ·»åŠ æ•°æ®åˆ†æå’ŒæŠ¥å‘ŠåŠŸèƒ½
- [ ] æ”¯æŒå¤šè¯­è¨€å›½é™…åŒ–

## ğŸ’¡ è·å–å¸®åŠ©

1. **æŸ¥çœ‹æ–‡æ¡£**: é˜…è¯» [ä½¿ç”¨æŒ‡å—.md](./ä½¿ç”¨æŒ‡å—.md)
2. **è¿è¡Œæµ‹è¯•**: æ‰§è¡Œ `python test_api.py`
3. **æ£€æŸ¥æ—¥å¿—**: æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯
4. **åœ¨çº¿æ–‡æ¡£**: è®¿é—® http://localhost:8000/docs

## ğŸ‰ å¼€å§‹ä½¿ç”¨

ç°åœ¨å°±å¼€å§‹æ‚¨çš„FFXIVæˆ˜æ–—æ•°æ®APIä¹‹æ—…å§ï¼

1. **è¿è¡Œå¯åŠ¨è„šæœ¬**: `start.bat` (Windows) æˆ– `./start.sh` (Linux/Mac)
2. **æ‰“å¼€å‰ç«¯ç¤ºä¾‹**: `frontend_example.html`
3. **è¿è¡ŒåŠŸèƒ½æµ‹è¯•**: `python test_api.py`
4. **å¼€å§‹é›†æˆ**: ä½¿ç”¨APIæ„å»ºæ‚¨çš„åº”ç”¨

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ ğŸ®âœ¨